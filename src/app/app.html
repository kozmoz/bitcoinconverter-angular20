<!-- Header bar -->
<div class="bg-primary text-white py-3 mb-4">
  <div class="container">
    <h1 class="h3 mb-0">Angular 21 Bitcoin Converter</h1>
    <p class="mb-0 small opacity-75">Live BTC price via CoinGecko</p>
  </div>
</div>

<div class="container mb-5">
  <div class="row g-4 align-items-start">
    <!-- Left: Form -->
    <div class="col-12 col-lg-6">

      <div class="mb-3 row">
        <label class="col-sm-2 col-form-label" for="currency">Currency</label>
        <div class="col-sm-10">
          <select id="currency" class="form-select w-auto" [ngModel]="currency()"
                  (ngModelChange)="onCurrencyChange($event)"
                  [disabled]="currency() === 'eur' ? (priceEur$ | async) === null : (priceUsd$ | async) === null">
            <option value="eur">EUR</option>
            <option value="usd">USD</option>
          </select>
        </div>
      </div>

      <div class="mb-3 row">
        <label class="col-sm-2 col-form-label d-block">Direction</label>
        <div class="col-sm-10">
          <select class="form-select w-auto" [ngModel]="direction()" (ngModelChange)="direction.set($event)"
                  [disabled]="currency() === 'eur' ? (priceEur$ | async) === null : (priceUsd$ | async) === null">
            <option value="btc-to-fiat">BTC → {{ currency() === 'eur' ? 'Euro' : 'Dollar' }}</option>
            <option value="fiat-to-btc">{{ currency() === 'eur' ? 'Euro' : 'Dollar' }} → BTC</option>
          </select>
        </div>
      </div>

      <div class="mb-3 row">
        <label class="col-sm-2 col-form-label">Amount</label>
        <div class="col-sm-10">
          <div class="input-group" style="width: 20em;">
            <span class="input-group-text">
              {{ (direction() === 'btc-to-fiat') ? 'BTC' : (currency() === 'eur' ? 'EUR' : 'USD') }}
            </span>
            <input class="form-control" type="number"
                   [attr.step]="direction() === 'btc-to-fiat' ? '0.000001' : '1'"
                   min="0" [ngModel]="amount()" (ngModelChange)="amount.set($event)"
                   [disabled]="(priceEur$ | async) === null || (priceUsd$ | async) === null"/>
          </div>
          <div class="form-text">The amount that is user for the calculations.</div>
        </div>
      </div>
    </div>

    <!-- Right: Rate Panel -->
    <div class="col-12 col-lg-6">
      <div class="border border-2 border-primary rounded-4 p-4">
        <div class="display-6 fw-semibold text-center mb-3">

          @let eur = priceEur$ | async;
          @let usd = priceUsd$ | async;
          @if (eur === null || usd === null) {
            <div class="text-muted">Loading current rate…</div>
          } @else {

            @if (direction() === 'fiat-to-btc') {
              @if (currency() === 'eur') {
                {{ amount() | currency:'EUR':'symbol':'1.2-2' }}
                ≈ <strong>{{ amount() / eur | number:'1.8-8' }}&nbsp;BTC</strong>
              }
              @if (currency() === 'usd') {
                {{ amount() | currency:'USD':'symbol':'1.2-2' }}
                ≈ <strong>{{ amount() / usd | number:'1.8-8' }}&nbsp;BTC</strong>
              }
            }

            @if (direction() === 'btc-to-fiat') {
              {{ amount() | number:'1.8-8' }}&nbsp;BTC
              @if (currency() === 'eur') {
                ≈ <strong>{{ amount() * eur | currency:'EUR':'symbol':'1.2-2' }}</strong>
              }
              @if (currency() === 'usd') {
                ≈ <strong>{{ amount() * usd | currency:'USD':'symbol':'1.2-2' }}</strong>
              }
            }

          }
        </div>
        <div class="text-center text-muted mb-2">The exchange rate updates every minute.</div>
        <div class="text-center text-muted">
          Last update at: @if (lastUpdatedEur$ | async; as t) {
          <strong>{{ t | date:'HH:mm' }}</strong>
        } @else {
          <em>—</em>
        }, <br/>
          1 BTC = {{ (priceEur$ | async) | currency:'EUR':'symbol':'1.2-2' }}, <br/>
          1 BTC = {{ (priceUsd$ | async) | currency:'USD':'symbol':'1.2-2' }}
        </div>
      </div>
    </div>
  </div>

  <!-- Below: details and conversions -->
  <div class="mt-4">
    @let err = (errorEur$ | async);
    @if (err) {
      <div class="alert alert-danger" role="alert">{{ err }}</div>
    }
  </div>
</div>
